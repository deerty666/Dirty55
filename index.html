<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù…Ø·Ø§Ø¹Ù… Ø³Ø­Ø§ÙŠØ¨ Ø¯ÙŠØ±ØªÙŠ â€” Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="manifest" href="/manifest.json">
  <style>
    :root{
      --brown-dark:#2f1b12;
      --brown:#3b2314;
      --gold:#d3a15e;
      --cream:#f6e9d6;
    }
    html,body { font-family: 'Cairo', sans-serif; background: linear-gradient(180deg,var(--brown-dark), #2b1a10); color:var(--cream); }
    .glass { background: rgba(255,255,255,0.03); backdrop-filter: blur(4px); border:1px solid rgba(255,255,255,0.03); }
    #installBanner { display:none; }
  </style>
</head>
<body class="min-h-screen">
  <div id="installBanner" class="glass sticky top-0 z-50 p-3 flex justify-center items-center">
    <button id="installButton" class="flex items-center gap-2 px-4 py-2 rounded-xl shadow-md" style="background:var(--gold); color:#2b1a10; font-weight:700;">
      ğŸ“± Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„ØªØ«Ø¨ÙŠØª ØªØ·Ø¨ÙŠÙ‚ Ù…Ø·Ø§Ø¹Ù… Ø³Ø­Ø§ÙŠØ¨ Ø¯ÙŠØ±ØªÙŠ
    </button>
  </div>

  <header class="p-5">
    <div class="max-w-3xl mx-auto">
      <div class="flex items-center justify-between">
        <h1 class="text-3xl" style="color:var(--gold); font-weight:800;">Ù…Ø·Ø§Ø¹Ù… Ø³Ø­Ø§ÙŠØ¨ Ø¯ÙŠØ±ØªÙŠ</h1>
        <div class="flex items-center gap-3">
          <button id="cartBtn" class="relative glass p-2 rounded-lg">ğŸ›’
            <span id="cartCount" class="absolute -top-1 -left-1 bg-amber-400 text-brown-900 text-xs rounded-full px-2">0</span>
          </button>
        </div>
      </div>

      <div class="mt-4">
        <input id="searchInput" dir="rtl" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø·Ø¨Ù‚ Ø£Ùˆ Ù…Ø´Ø±ÙˆØ¨..." class="w-full p-3 rounded-full glass placeholder:opacity-60" />
      </div>

      <div id="sections" class="mt-4 flex gap-3 overflow-x-auto py-2"></div>
    </div>
  </header>

  <main class="max-w-3xl mx-auto pb-28">
    <div id="menuList" class="grid grid-cols-1 gap-4 p-4"></div>
  </main>
  <!-- Modal -->
  <div id="productModal" class="fixed inset-0 hidden z-50 items-end md:items-center justify-center p-4">
    <div class="bg-[#231610] w-full md:max-w-lg rounded-t-2xl md:rounded-2xl p-5 glass">
      <div class="flex justify-between items-start">
        <div>
          <h2 id="modalTitle" class="text-2xl font-bold"></h2>
          <p id="modalSub" class="opacity-60"></p>
        </div>
        <button id="closeModal" class="text-xl">âœ–ï¸</button>
      </div>
      <div id="modalOptions" class="mt-4 space-y-4"></div>
      <div class="mt-4 flex justify-between items-center">
        <div class="text-xl font-bold" id="modalPrice">0 Ø±ÙŠØ§Ù„</div>
        <div>
          <button id="addToCartBtn" class="px-4 py-2 rounded-lg" style="background:var(--gold); color:#2b1a10; font-weight:700;">Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø© ğŸ›’</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Cart Drawer -->
  <div id="cartDrawer" class="fixed inset-0 hidden z-50">
    <div class="absolute inset-0 bg-black/40" id="cartOverlay"></div>
    <div class="absolute bottom-0 left-0 right-0 bg-[#21140f] rounded-t-2xl p-5 max-h-[80vh] overflow-y-auto">
      <div class="flex justify-between items-center">
        <h3 class="text-xl font-bold">Ø§Ù„Ø³Ù„Ø©</h3>
        <button id="closeCart" class="text-xl">âœ–ï¸</button>
      </div>

      <!-- Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨: Ø§Ø³ØªÙ„Ø§Ù… Ø§Ùˆ ØªÙˆØµÙŠÙ„ -->
      <div class="mt-4 glass p-3 rounded flex gap-4 items-center">
        <label class="font-bold">Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨:</label>
        <select id="orderType" class="p-2 rounded-md text-black">
          <option value="pickup">Ø§Ø³ØªÙ„Ø§Ù… (Ø¨Ø¯ÙˆÙ† Ø±Ø³ÙˆÙ…)</option>
          <option value="delivery">ØªÙˆØµÙŠÙ„ (Ù¥ Ø±ÙŠØ§Ù„)</option>
        </select>
      </div>

      <div id="cartItems" class="mt-4 space-y-3"></div>

      <div class="mt-4 border-t border-white/10 pt-4 flex justify-between items-center">
        <div class="text-lg">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
        <div id="cartTotalBottom" class="text-2xl font-bold">0 Ø±ÙŠØ§Ù„</div>
      </div>

      <div class="mt-4 flex gap-3">
        <button id="sendWhatsapp" class="flex-1 py-3 rounded-lg" style="background:var(--gold); color:#2b1a10; font-weight:700;">Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</button>
        <button id="clearCart" class="flex-1 py-3 rounded-lg glass">Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø©</button>
      </div>
    </div>
  </div>

  <div id="toast" class="fixed left-1/2 -translate-x-1/2 bottom-28 hidden z-50 p-3 rounded-md" style="background:#111; color:var(--gold);"></div>

  <script>
    /********** Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ÙŠÙˆ **********/
    const menuData = [
      { section:"Ø§Ù„Ø´ÙˆØ§ÙŠÙ‡", items:[{id:"sh1",icon:"ğŸ—",name:"Ø´ÙˆØ§ÙŠØ© - Ø­Ø¨Ø© ÙƒØ§Ù…Ù„Ø© (Ø±Ø² Ø´Ø¹Ø¨ÙŠ)",price:46},{id:"sh2",icon:"ğŸ—",name:"Ø´ÙˆØ§ÙŠØ© - Ù†ØµÙ Ø­Ø¨Ø© (Ø±Ø² Ø´Ø¹Ø¨ÙŠ)",price:24}]},
      { section:"Ù…Ø¸Ø¨ÙŠ", items:[{id:"md1",icon:"ğŸ–",name:"Ù…Ø¸Ø¨ÙŠ - Ø­Ø¨Ø© ÙƒØ§Ù…Ù„Ø© (Ø±Ø² Ø´Ø¹Ø¨ÙŠ)",price:46}]},
      { section:"Ù…Ù†Ø¯ÙŠ", items:[{id:"mn1",icon:"ğŸ›",name:"Ù…Ù†Ø¯ÙŠ - Ø­Ø¨Ø© ÙƒØ§Ù…Ù„Ø© (Ø±Ø² Ø´Ø¹Ø¨ÙŠ)",price:46}]},
      { section:"Ù…Ø¶ØºÙˆØ·", items:[{id:"mp1",icon:"ğŸ½ï¸",name:"Ù…Ø¶ØºÙˆØ· - Ø­Ø¨Ø© ÙƒØ§Ù…Ù„Ø©",price:50}]},
      { section:"Ø²Ø±Ø¨ÙŠØ§Ù†", items:[{id:"zr1",icon:"ğŸš",name:"Ø²Ø±Ø¨ÙŠØ§Ù† - Ø­Ø¨Ø© ÙƒØ§Ù…Ù„Ø©",price:50}]}
      // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø¨Ù†ÙØ³ Ø§Ù„Ø£Ø³Ù„ÙˆØ¨
    ];

    const sectionsEl = document.getElementById('sections');
    const menuList = document.getElementById('menuList');
    const productModal = document.getElementById('productModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalSub = document.getElementById('modalSub');
    const modalOptions = document.getElementById('modalOptions');
    const modalPrice = document.getElementById('modalPrice');
    const addToCartBtn = document.getElementById('addToCartBtn');
    const closeModal = document.getElementById('closeModal');

    const cartDrawer = document.getElementById('cartDrawer');
    const cartOverlay = document.getElementById('cartOverlay');
    const cartItemsEl = document.getElementById('cartItems');
    const cartTotalBottom = document.getElementById('cartTotalBottom');
    const cartCount = document.getElementById('cartCount');
    const cartTotal = document.getElementById('cartTotal');
    const orderType = document.getElementById('orderType');

    let cart = JSON.parse(localStorage.getItem('deerty_cart')||'[]');

    /********** Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… **********/
    function renderSections(){
      sectionsEl.innerHTML='';
      menuData.forEach(sec=>{
        const btn=document.createElement('button');
        btn.className='px-4 py-2 rounded-full glass whitespace-nowrap';
        btn.innerText=sec.section;
        btn.onclick=()=>renderMenu(sec.items,sec.section);
        sectionsEl.appendChild(btn);
      });
      menuData[0] && renderMenu(menuData[0].items,menuData[0].section);
    }

    /********** Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª **********/
    function renderMenu(items, sectionName){
      menuList.innerHTML='';
      items.forEach(item=>{
        const card=document.createElement('div');
        card.className='glass p-4 rounded-xl flex justify-between items-center';
        card.innerHTML=`
          <div class="flex items-center gap-3">
            <div class="text-3xl">${item.icon}</div>
            <div>
              <h3 class="text-xl font-bold">${item.name}</h3>
              <p class="opacity-60">${sectionName}</p>
            </div>
          </div>
          <div class="flex flex-col items-end gap-2">
            <div class="text-2xl font-extrabold">${item.price} <span class="text-sm">Ø±ÙŠØ§Ù„</span></div>
            <button class="mt-2 px-3 py-2 rounded-lg" style="background:var(--gold); color:#2b1a10; font-weight:700;">Ø¹Ø±Ø¶</button>
          </div>
        `;
        card.querySelector('button').addEventListener('click',()=>openModal(item,sectionName));
        menuList.appendChild(card);
      });
    }

    /********** Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ **********/
    let currentItem=null;
    function openModal(item,sectionName){
      currentItem=item;
      modalTitle.innerText=item.name;
      modalSub.innerText=sectionName;
      modalOptions.innerHTML='';

      // Ø§Ù„ÙƒÙ…ÙŠØ©
      const qtyDiv=document.createElement('div');
      qtyDiv.className='flex items-center gap-3';
      qtyDiv.innerHTML=`<label class="opacity-70">Ø§Ù„ÙƒÙ…ÙŠØ©:</label><button id="decQty" class="px-3 py-1 glass rounded">-</button><span id="qtyVal" class="px-3">1</span><button id="incQty" class="px-3 py-1 glass rounded">+</button>`;
      modalOptions.appendChild(qtyDiv);

      // Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©
      const noteDiv=document.createElement('div');
      noteDiv.innerHTML=`<textarea id="itemNote" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø© (Ù…Ø«Ù„: Ø¨Ø¯ÙˆÙ† Ù…Ù„Ø­)" class="w-full p-2 mt-2 rounded-md glass" rows="2"></textarea>`;
      modalOptions.appendChild(noteDiv);

      // Ø§Ù„Ø³Ø¹Ø±
      let qty=1;
      modalPrice.innerText=item.price+' Ø±ÙŠØ§Ù„';
      document.getElementById('decQty').addEventListener('click',()=>{if(qty>1){qty--;document.getElementById('qtyVal').innerText=qty;modalPrice.innerText=(item.price*qty)+' Ø±ÙŠØ§Ù„';}});
      document.getElementById('incQty').addEventListener('click',()=>{qty++;document.getElementById('qtyVal').innerText=qty;modalPrice.innerText=(item.price*qty)+' Ø±ÙŠØ§Ù„';});

      addToCartBtn.onclick=()=>{
        const note=document.getElementById('itemNote').value||'';
        addToCart({...item,qty,note});
        hideModal();
      };

      productModal.classList.remove('hidden'); productModal.classList.add('flex');
    }

    function hideModal(){productModal.classList.remove('flex');productModal.classList.add('hidden');}
    closeModal.addEventListener('click',hideModal);
    productModal.addEventListener('click',(e)=>{if(e.target===productModal)hideModal();});

    /********** Ø§Ù„Ø³Ù„Ø© **********/
    function saveCart(){localStorage.setItem('deerty_cart',JSON.stringify(cart));renderCart();}
    function addToCart(item){
      const found=cart.find(i=>i.id===item.id && i.note===item.note);
      if(found) found.qty+=item.qty; else cart.push({id:item.id,name:item.name,price:item.price,qty:item.qty,note:item.note});
      showToast('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©');
      saveCart();
    }

    function renderCart(){
      cartItemsEl.innerHTML='';
      let total=0;let count=0;
      cart.forEach((it,idx)=>{
        const row=document.createElement('div');
        row.className='flex justify-between items-center glass p-3 rounded';
        row.innerHTML=`
          <div>
            <div class="font-bold">${it.name}</div>
            ${it.note?`<div class="opacity-60 text-sm">Ù…Ù„Ø§Ø­Ø¸Ø©: ${it.note}</div>`:''}
          </div>
          <div class="text-right">
            <div class="font-bold">${it.price*it.qty} Ø±ÙŠØ§Ù„</div>
            <div class="flex gap-2 mt-2 justify-end items-center">
              <button class="glass px-2 py-1" data-action="dec" data-idx="${idx}">-</button>
              <div class="px-2">${it.qty}</div>
              <button class="glass px-2 py-1" data-action="inc" data-idx="${idx}">+</button>
              <button class="glass px-2 py-1" data-action="remove" data-idx="${idx}">Ø­Ø°Ù</button>
            </div>
          </div>
        `;
        cartItemsEl.appendChild(row);
        total+=it.price*it.qty; count+=it.qty;
      });

      // Ø¥Ø¶Ø§ÙØ© Ù¥ Ø±ÙŠØ§Ù„ Ø¥Ø°Ø§ Ø§Ù„ØªÙˆØµÙŠÙ„
      if(orderType.value==='delivery') total+=5;

      cartTotalBottom.innerText=total+' Ø±ÙŠØ§Ù„';
      cartTotal.innerText=total+' Ø±ÙŠØ§Ù„';
      cartCount.innerText=count;
      cartCount.style.display=count===0?'none':'inline-block';
      localStorage.setItem('deerty_cart',JSON.stringify(cart));
    }

    cartItemsEl.addEventListener('click',(e)=>{
      const action=e.target.dataset.action; const idx=e.target.dataset.idx;
      if(!action) return;
      if(action==='inc'){cart[idx].qty++; saveCart();}
      if(action==='dec'){if(cart[idx].qty>1) cart[idx].qty--; else cart.splice(idx,1); saveCart();}
      if(action==='remove'){cart.splice(idx,1); saveCart();}
    });

    document.getElementById('openCartBottom')?.addEventListener('click',()=>{cartDrawer.classList.remove('hidden');cartDrawer.classList.add('block');renderCart();});
    document.getElementById('cartBtn')?.addEventListener('click',()=>{cartDrawer.classList.remove('hidden');cartDrawer.classList.add('block');renderCart();});
    document.getElementById('closeCart')?.addEventListener('click',()=>cartDrawer.classList.add('hidden'));
    cartOverlay.addEventListener('click',()=>cartDrawer.classList.add('hidden'));
    document.getElementById('clearCart')?.addEventListener('click',()=>{cart=[];saveCart();showToast('ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø©');});

    // ÙˆØ§ØªØ³Ø§Ø¨
    const whatsappPhone='966536803598';
    document.getElementById('sendWhatsapp')?.addEventListener('click',()=>{
      if(cart.length===0){showToast('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©'); return;}
      const lines=['Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ù…Ø·Ø§Ø¹Ù… Ø³Ø­Ø§ÙŠØ¨ Ø¯ÙŠØ±ØªÙŠ:'];
      cart.forEach(it=>{
        lines.push(`${it.qty} Ã— ${it.name} â€” ${it.price*it.qty} Ø±ÙŠØ§Ù„${it.note?' (Ù…Ù„Ø§Ø­Ø¸Ø©: '+it.note+')':''}`);
      });
      let total=cart.reduce((s,i)=>s+i.price*i.qty,0);
      if(orderType.value==='delivery') total+=5;
      lines.push(`Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨: ${orderType.value==='pickup'?'Ø§Ø³ØªÙ„Ø§Ù…':'ØªÙˆØµÙŠÙ„ 5 Ø±ÙŠØ§Ù„'}`);
      lines.push(`Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total} Ø±ÙŠØ§Ù„`);
      const text=encodeURIComponent(lines.join('\n'));
      const url=`https://wa.me/${whatsappPhone}?text=${text}`;
      window.open(url,'_blank');
    });

    function showToast(msg,time=2000){
      const t=document.getElementById('toast');
      t.innerText=msg;
      t.classList.remove('hidden'); t.classList.add('block');
      setTimeout(()=>{t.classList.remove('block');t.classList.add('hidden');},time);
    }

    // init
    renderSections();
    renderCart();
  </script>
</body>
</html>
